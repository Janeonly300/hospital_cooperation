<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>环形图</title>
    <link rel="stylesheet" href="../../../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../../../css/oksub.css">
</head>
<body>
<div class="layui-row">
    <div class="layui-form" style="margin-top:15px;margin-bottom: 25px">
        <div class="layui-inline">
            <label class="layui-form-label">时间</label>
            <div class="layui-input-block">
                <select name="dateType" id="dateType">
                    <option value='1'>最近一个月</option>
                    <option value='2'>最近三个月</option>
                    <option value='3'>最近半年</option>
                    <option value='4'>最近一年</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-inline" style="margin-right: 8px">
                <button class="layui-btn" id="search">
                    <i class="layui-icon layui-icon-search" style="font-size: 14px">搜索</i>
                </button>
                <button class="layui-btn layui-inline" id="export">
                    <i class="layui-icon" style="font-size: 14px">导出</i>
                </button>
            </div>

        </div>
    </div>


</div>

<div id="main" style="width: 100%;height:400px;margin-top: 50px;"></div>

<script src="../../../lib/echarts/echarts.min.js"></script>
<script src="../../../lib/layui/layui.js"></script>
<script src="../../../lib/layui/lay/modules/excel.js"></script>
<script src="../../../js/jquery.min.js"></script>
<script src="../../../js/application.js"></script>
<script src="../../../js/selectMore.js"></script>
<script src="/js/hyx.js"></script>
<script src="/js/jquery.min.js"></script>

<script>
    $(document).ready(function(){
        layui.use(["table", 'form', 'okLayer', 'layer'], function () {
            let $ = layui.jquery;
            let layer = layui.layer;
        })

        $("#export").click(function (){
            $.ajax({
                url:'/hos/diagnosis_info/get_diagnosis_list',
                type:'get',
                data:{
                    page:1,
                    limit:5
                },
                success:function(res){
                    if(res.code == '201'){
                        layer.msg(res.data.msg,{icon: 5});//失败的表情
                    }else{
                        let rs = [];
                        let datas = res.data;
                        for(let i=0;i<res.data.length;i++)
                        {
                            let dia = {};
                            //格式化时间
                            let date = new Date(datas[i].disgnose_info.create_time).Format("yyyy-MM-dd HH:mm:ss");
                            //出生日期
                            let birth = new Date(datas[i].disgnose_info.patient_birth).Format("yyyy-MM-dd");

                            dia.disgnose_code = datas[i].disgnose_info.disgnose_code;
                            dia.hos_name = datas[i].hos_info.hos_name;
                            dia.doctor_name = datas[i].doctor_info.doctor_name;
                            if(datas[i].doctor_info.stat==1)
                            {
                                dia.stat = "协助医师"
                            }else if(datas[i].doctor_info.stat==2) {
                                dia.stat = "普通医师"
                            }else {
                                dia.stat = "已注销"
                            }
                            dia.patient_name = datas[i].disgnose_info.patient_name;
                            dia.patient_birth = birth;
                            dia.patient_tall = datas[i].disgnose_info.patient_tall;
                            dia.patient_weight = datas[i].disgnose_info.patient_weight;
                            dia.diagnose_result = datas[i].disgnose_info.diagnose_result;

                            dia.create_time = date;
                            dia.create_time2 = date;
                            dia.comment_text = datas[i].disgnose_info.comment_text;
                            dia.stat2 = datas[i].disgnose_info.stat;
                            rs.push(dia);
                        }

                        // 1. 数组头部新增表头
                        rs.unshift({disgnose_code: '病例编码',hos_name: '单位名称', doctor_name: '医师姓名'
                            , stat: '医师类型', patient_name: '患者姓名', patient_birth: '患者出生日期', patient_tall: '患者身高'
                            , patient_weight: '患者体重', diagnose_result: '诊断结果', create_time: '诊断日期', create_time2: '申请日期'
                            , stat2: '状态'});
                        // 2. 如果需要调整顺序，请执行梳理函数
                        // var data = LAY_EXCEL.filterExportData(data.data, [
                        //     'name',
                        //     'sex',
                        //     'age',
                        // ]);
                        // 3. 执行导出函数，系统会弹出弹框
                        LAY_EXCEL.exportExcel({
                            sheet1: rs
                        }, '导出接口数据.xlsx', 'xlsx');
                    }
                },
            });
        })
    });
</script>
<script type="text/javascript">
    layui.use(['layedit', 'upload', 'element', 'form', 'okLayer'], function () {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        var data=[{"value":10,"name":"未诊断病情"},{"value":5,"name":"已诊断病情"}]

        chart(data)


        //渲染图
        function chart(data) {
            myChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b}: {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    x: 'left',
                    data: ['已诊断病情','未诊断病情']
                },
                series: [
                    {
                        name: '病情数据',
                        type: 'pie',
                        radius: ['50%', '70%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: false,
                                position: 'center'
                            },
                            emphasis: {
                                show: true,
                                textStyle: {
                                    fontSize: '30',
                                    fontWeight: 'bold'
                                }
                            }
                        },
                        labelLine: {
                            normal: {
                                show: false
                            }
                        },
                        data:data
                    }
                ]
            });
            window.addEventListener("resize", function () {
                myChart.resize();
            });
        }
    })
</script>
</body>
</html>
