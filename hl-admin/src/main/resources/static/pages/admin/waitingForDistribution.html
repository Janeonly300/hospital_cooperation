<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员分配诊断</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css">
</head>

<style>
    .tdAdapt {
        font-size: 16.0pt;
        word-wrap: break-word;
        word-break: break-all;
    }

    .textarea {
        margin-right: 3px;
    }

    .divarea {
        margin-bottom: 5px;
    }

    .tub {
        font-size: 16px;
        margin-right: 5px;
    }
</style>

<body>
<div class="layui-bg-gray" style="padding: 30px;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">诊断信息</div>
                <div class="layui-card-body">
                    <sapn class="textarea">诊断编码 : <span id="disgnose_code"></span></sapn>
                    <br>
                    <sapn class="textarea">申请单位 : <span id="hos_nme"></span></sapn>
                    <br>
                    <sapn class="textarea">申请医生 : <span id="doctor_name"></span></sapn>
                    <br>
                    <sapn class="textarea">诊断 : <span id="diagnose_result"></span></sapn>
                    <br>
                    <sapn class="textarea">申请时间 : <span id="create_time"></span></sapn>
                    <br>
                </div>
            </div>
        </div>
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">患者信息</div>
                <div class="layui-card-body">
                    <sapn class="textarea">患者姓名 : <span id="patient_name"></span></sapn>
                    <br>
                    <sapn class="textarea">患者出生日期 : <span id="patient_birth"></span></sapn>
                    <br>
                    <sapn class="textarea">患者身高 : <span id="patient_tall"></span></sapn>
                    <br>
                    <sapn class="textarea">患者体重 : <span id="patient_weight"></span></sapn>
                    <br>
                </div>
            </div>
        </div>

        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">诊断附件</div>
                <div class="layui-card-body">
                    <div>
                        <div class="layui-upload-list" style="max-width: 1000px;">
                            <table class="layui-table">
                                <colgroup>
                                    <col>
                                    <col width="150">
                                    <col width="260">
                                    <col width="150">
                                </colgroup>
                                <thead>
                                <tr><th>文件名</th>
                                    <th>大小</th>
                                </tr></thead>
                                <tbody id="demoList">
                                <tr><td>附件1.xml</td>
                                    <td>20MB</td>
                                </tr>
                                <tr><td>附件2.jpg</td>
                                    <td>5MB</td>
                                </tr>
                                <tr><td>附件3.mp4</td>
                                    <td>890MB</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="ok-body" style="background: #F8F8F8">
    <div class="layui-row ">
        <div class="layui-col-md8" style="background-color:#f8f8f8;">
            <div style="background: #d2d2d2">
                <div style="width: 100%;height: 100%;margin: 0 auto;">
                    <!--流程显示页面-->
                    <div style="background-color:#fdfdfd;">
                        <iframe scrolling="yes" frameborder="0" width="100%"
                                height="700px" id="processData"
                                onload="this.height=0;var fdh=(this.Document?this.Document.body.scrollHeight:this.contentDocument.body.offsetHeight);this.height=(fdh>700?fdh:700)"></iframe>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md4" style="background-color:#f8f8f8;">
                <legend style="font-size: 20px">操作处理</legend>
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body">
                            <div class="layui-form">
                                <div class="layui-form-item" pane="">
                                    <div class="layui-input-block">
                                        <div class="layui-row">
                                            <div class="layui-col-md6">
                                                <input type="radio" name="shenqing" value="回退申请" title="回退申请">
                                            </div>
                                            <div class="layui-col-md6">
                                                <input type="radio" name="shenqing" value="分配诊断任务" title="分配诊断任务">
                                            </div>
                                        </div>
                                        <div class="layui-row">
                                            <div class="layui-col-md6">
                                                <input type="radio" name="shenqing" value="驳回诊断报告" title="驳回诊断报告">
                                            </div>
                                            <div class="layui-col-md6">
                                                <input type="radio" name="shenqing" value="反馈诊断报告" title="反馈诊断报告">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form">
                                <div class="layui-form-item" style="margin-top: 20px">
                                    <div style="margin: 10px">医院</div>
                                    <div class="layui-form-item layui-form-text" style="display: inline">
                                        <select name="director" lay-filter="director" lay-verify="required">
                                            <option value='1'>人民医院1</option>
                                            <option value='2'>人民医院2</option>
                                            <option value='3'>人民医院3</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="checkUser" class="layui-form-item" style="margin-top: 20px">
                                    <div style="margin: 10px">医生</div>
                                    <div class="layui-form-item layui-form-text" style="display: inline" id="select">
                                        <select name="director" id="director" lay-filter="director" lay-verify="required">
                                            <option value='1'>医生1</option>
                                            <option value='2'>医生2</option>
                                            <option value='3'>医生3</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <div class="layui-form-item layui-form-text" style="margin: 10px">
                                        操作备注
                                    </div>
                                    <div>
                                        <textarea name="checkOpinion" required lay-verify="required" placeholder="输入处理备注"
                                                  class="layui-textarea"></textarea>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <button type="button" class="layui-btn" lay-submit lay-filter="add" id="submit">确认</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </div>
    </div>
</div>
<br/>
</body>

<script src="../../lib/layui/layui.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/application.js"></script>
<script src="/js/hyx.js"></script>

<script>
    $(document).ready(function(){
        //获取诊断编号
        var disgnose_id = GetQueryString("disgnose_id");

        //甚至诊断iframe的src
        $("#processData").attr("src","/pages/commonData/processData.html?disgnose_id="+disgnose_id);

        //设置分配信息
        $.ajax({
            url:'/hos/diagnosis_info/get_diagnosis_by_id',
            type:'get',
            data:{
                'id':disgnose_id
            },
            success:function(data){
                if(data.code == '201'){
                    alert(data.data.msg);//失败的表情
                }else{
                    let datas = data.data;
                    let rs = [];
                    for(let i=0;i<datas.length;i++)
                    {
                        let dia = {};
                        //格式化时间
                        let date = new Date(datas[i].disgnose_info.create_time).Format("yyyy-MM-dd HH:mm:ss");
                        //出生日期
                        let birth = new Date(datas[i].disgnose_info.patient_birth).Format("yyyy-MM-dd");

                        dia.doctor_name = datas[i].doctor_info.doctor_name;
                        dia.patient_name = datas[i].disgnose_info.patient_name;
                        dia.patient_birth = birth;
                        dia.patient_tall = datas[i].disgnose_info.patient_tall;
                        dia.patient_weight = datas[i].disgnose_info.patient_weight;
                        dia.diagnose_result = datas[i].disgnose_info.diagnose_result;
                        dia.hos_nme = datas[i].hos_info.hos_name;
                        dia.create_time = date;
                        dia.comment_text = datas[i].disgnose_info.comment_text;
                        dia.disgnose_code = datas[i].disgnose_info.disgnose_code;
                        dia.stat = datas[i].disgnose_info.stat;

                        $("#hos_nme").text(dia.hos_nme)
                        $("#patient_name").text(dia.patient_name)
                        $("#patient_birth").text(dia.patient_birth)
                        $("#patient_tall").text(dia.patient_tall)
                        $("#patient_weight").text(dia.patient_weight)
                        $("#diagnose_result").text(dia.diagnose_result)
                        $("#doctor_name").text(dia.doctor_name)
                        $("#create_time").text(dia.create_time)
                        $("#disgnose_code").text(dia.disgnose_code)

                        //根据诊断状态显示不同的操作菜单
                        switch (dia.stat) {
                            case 1:
                            case 2:
                                $("input:radio").eq(0).attr("disabled",false);
                                $("input:radio").eq(1).attr("disabled",false);
                                $("input:radio").eq(2).attr("disabled",true);
                                $("input:radio").eq(3).attr("disabled",true);
                                break;
                            case 3:
                            case 4:
                                $("input:radio").eq(0).attr("disabled",true);
                                $("input:radio").eq(1).attr("disabled",true);
                                $("input:radio").eq(2).attr("disabled",false);
                                $("input:radio").eq(3).attr("disabled",false);
                                break;
                            case 5:
                                $("input:radio").eq(0).attr("disabled",true);
                                $("input:radio").eq(1).attr("disabled",true);
                                $("input:radio").eq(2).attr("disabled",true);
                                $("input:radio").eq(3).attr("disabled",true);
                                break;
                        }
                    }

                }
            },
        });
    });
</script>

<script>
    let processDataHeight = 0
    //获取处理过程信息
    function getprocessData(processId) {
        $("#processData").on("load", function () {
            var data = {processId: processId}
            this.contentWindow.getParentData(data)
        })
    }



    layui.use(['element','form'], function () {
        var form = layui.form
        form.render('select');
    });


    function caseReturnData(returnData) {

    }

    function processReturnData(returnData) {
        $("#processData").height(returnData.height)
        processDataHeight = returnData.height
    }
</script>

</html>