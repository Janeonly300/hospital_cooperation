<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员分配诊断</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css">
</head>

<style>
    .tdAdapt {
        font-size: 16.0pt;
        word-wrap: break-word;
        word-break: break-all;
    }

    .textarea {
        margin-right: 3px;
    }

    .divarea {
        margin-bottom: 5px;
    }

    .tub {
        font-size: 16px;
        margin-right: 5px;
    }
</style>

<body>
<div class="layui-bg-gray" style="padding: 30px;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">诊断信息</div>
                <div class="layui-card-body">
                    <sapn class="textarea">诊断编码 : <span id="disgnose_code"></span></sapn>
                    <br>
                    <sapn class="textarea">申请单位 : <span id="hos_nme"></span></sapn>
                    <br>
                    <sapn class="textarea">申请医生 : <span id="doctor_name"></span></sapn>
                    <br>
                    <sapn class="textarea">诊断 : <span id="diagnose_result"></span></sapn>
                    <br>
                    <sapn class="textarea">申请时间 : <span id="create_time"></span></sapn>
                    <br>
                </div>
            </div>
        </div>
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">患者信息</div>
                <div class="layui-card-body">
                    <sapn class="textarea">患者姓名 : <span id="patient_name"></span></sapn>
                    <br>
                    <sapn class="textarea">患者出生日期 : <span id="patient_birth"></span></sapn>
                    <br>
                    <sapn class="textarea">患者身高 : <span id="patient_tall"></span></sapn>
                    <br>
                    <sapn class="textarea">患者体重 : <span id="patient_weight"></span></sapn>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="ok-body" style="background: #F8F8F8">
    <div class="layui-row ">
        <div class="layui-col-md9" style="background-color:#f8f8f8;">
            <div class="layui-row">
                <hr class="layui-bg-gray">
                <fieldset class="layui-elem-field">
                    <div>
                        <div style="background: #d2d2d2">
                            <div style="width: 80%;height: 100%;margin: 0 auto;">
                                <!--                                <div class="layui-collapse" lay-filter="waitingData">-->
                                <!--                                    <div class="layui-colla-item">-->
                                <!--                                        <div class="layui-colla-content layui-show" style="background-color:#fdfdfd;">-->
                                <!--                                            <div style="background-color:#fdfdfd;">-->
                                <!--                                                <iframe scrolling="no" frameborder="0"-->
                                <!--                                                        src="../commonData/submitData.html" width="100%"-->
                                <!--                                                        height="700px" id="waitingData"-->
                                <!--                                                        onload="this.height=0;var fdh=(this.Document?this.Document.body.scrollHeight:this.contentDocument.body.offsetHeight);this.height=(fdh>700?fdh:700);"></iframe>-->
                                <!--                                            </div>-->
                                <!--                                        </div>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                                <div class="layui-col-md12">
                                    <div class="layui-card">
                                        <div class="layui-card-header">诊断附件</div>
                                        <div class="layui-card-body">
                                            <div>
                                                <div class="layui-upload-list" style="max-width: 1000px;">
                                                    <table class="layui-table">
                                                        <colgroup>
                                                            <col>
                                                            <col width="150">
                                                            <col width="260">
                                                            <col width="150">
                                                        </colgroup>
                                                        <thead>
                                                        <tr><th>文件名</th>
                                                            <th>大小</th>
                                                        </tr></thead>
                                                        <tbody id="demoList">
                                                        <tr><td>附件1.xml</td>
                                                            <td>20MB</td>
                                                        </tr>
                                                        <tr><td>附件2.jpg</td>
                                                            <td>5MB</td>
                                                        </tr>
                                                        <tr><td>附件3.mp4</td>
                                                            <td>890MB</td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <!--流程显示页面-->
                                <div style="background-color:#fdfdfd;margin-top: 40px;padding-top: 20px;">
                                    <iframe scrolling="yes" frameborder="0" width="100%"
                                            height="700px" id="processData"
                                            onload="this.height=0;var fdh=(this.Document?this.Document.body.scrollHeight:this.contentDocument.body.offsetHeight);this.height=(fdh>700?fdh:700)"></iframe>

                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="layui-col-md3" style="background-color:#f8f8f8;">
            <fieldset class="layui-elem-field">
                <legend style="font-size: 20px">诊断结果处理</legend>

                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">诊断申请</div>
                        <div class="layui-card-body">
                            <div class="layui-form">
                                <div class="layui-form-item" pane="">
                                    <label class="layui-form-label">操作</label>
                                </div>
                            </div>

                            <fieldset class="layui-elem-field layui-field-title" >
                                <legend>附件上传</legend>
                            </fieldset>
                            <div class="layui-upload">
                                <button type="button" class="layui-btn layui-btn-normal" id="testList">选择多文件</button>
                                <div class="layui-upload-list" style="max-width: 1000px;">
                                    <table class="layui-table">
                                        <colgroup>
                                            <col>
                                            <col width="150">
                                            <col width="260">
                                            <col width="150">
                                        </colgroup>
                                        <thead>
                                        <tr><th>文件名</th>
                                            <th>大小</th>
                                            <th>操作</th>
                                        </tr></thead>
                                        <tbody id=""></tbody>
                                    </table>
                                </div>
                                <button type="button" class="layui-btn" id="testListAction">开始上传</button>
                            </div>

                            <fieldset class="layui-elem-field layui-field-title" style="">
                                <legend>诊断申请</legend>
                            </fieldset>
                            <div class="ok-body">
                                <form class="layui-form layui-form-pane" action="">
                                    <div class="layui-form-item layui-form-text">
                                        <label class="layui-form-label">诊断结果</label>
                                        <div class="layui-input-block">
                                            <select  name="diagnose_result" class="layui-select">
                                                <option disabled selected>--结果选择--</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                                            <button type="submit" class="layui-btn layui-btn-primary">保存</button>
                                        </div>
                                    </div>

                                </form>



                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<br/>
</body>

<script src="../../lib/layui/layui.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/application.js"></script>
<script src="/js/hyx.js"></script>

<script>
    $(document).ready(function(){
        //获取诊断编号
        var disgnose_id = GetQueryString("disgnose_id");

        //甚至诊断iframe的src
        $("#processData").attr("src","/pages/commonData/processData.html?disgnose_id="+disgnose_id);

        //设置分配信息
        $.ajax({
            url:'/hos/diagnosis_info/get_diagnosis_by_id',
            type:'get',
            data:{
                'id':disgnose_id
            },
            success:function(data){
                if(data.code == '201'){
                    alert(data.data.msg);//失败的表情
                }else{
                    let datas = data.data;
                    let rs = [];
                    for(let i=0;i<datas.length;i++)
                    {
                        let dia = {};
                        //格式化时间
                        let date = new Date(datas[i].disgnose_info.create_time).Format("yyyy-MM-dd HH:mm:ss");
                        //出生日期
                        let birth = new Date(datas[i].disgnose_info.patient_birth).Format("yyyy-MM-dd");

                        dia.doctor_name = datas[i].doctor_info.doctor_name;
                        dia.patient_name = datas[i].disgnose_info.patient_name;
                        dia.patient_birth = birth;
                        dia.patient_tall = datas[i].disgnose_info.patient_tall;
                        dia.patient_weight = datas[i].disgnose_info.patient_weight;
                        dia.diagnose_result = datas[i].disgnose_info.diagnose_result;
                        dia.hos_nme = datas[i].hos_info.hos_name;
                        dia.create_time = date;
                        dia.comment_text = datas[i].disgnose_info.comment_text;
                        dia.disgnose_code = datas[i].disgnose_info.disgnose_code;
                        dia.stat = datas[i].disgnose_info.stat;

                        $("#hos_nme").text(dia.hos_nme)
                        $("#patient_name").text(dia.patient_name)
                        $("#patient_birth").text(dia.patient_birth)
                        $("#patient_tall").text(dia.patient_tall)
                        $("#patient_weight").text(dia.patient_weight)
                        $("#diagnose_result").text(dia.diagnose_result)
                        $("#doctor_name").text(dia.doctor_name)
                        $("#create_time").text(dia.create_time)
                        $("#disgnose_code").text(dia.disgnose_code)
                    }

                }
            },
        });
    });
</script>

<script>
    let processDataHeight = 0
    //获取处理过程信息
    function getprocessData(processId) {
        $("#processData").on("load", function () {
            var data = {processId: processId}
            this.contentWindow.getParentData(data)
        })
    }



    layui.use(['element','form'], function () {
        var form = layui.form
        form.render('select');
    });


    function caseReturnData(returnData) {

    }

    function processReturnData(returnData) {
        $("#processData").height(returnData.height)
        processDataHeight = returnData.height
    }
</script>

</html>