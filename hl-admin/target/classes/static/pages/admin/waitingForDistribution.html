<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员分配诊断</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css">
</head>

<style>
    .tdAdapt {
        font-size: 16.0pt;
        word-wrap: break-word;
        word-break: break-all;
    }

    .textarea {
        margin-right: 3px;
    }

    .divarea {
        margin-bottom: 5px;
    }

    .tub {
        font-size: 16px;
        margin-right: 5px;
    }
</style>

<body>
<div class="ok-body" style="background: #F8F8F8">
    <div class="layui-row ">
        <div class="layui-col-md9" style="background-color:#f8f8f8;">
            <div class="layui-row">
                <hr class="layui-bg-gray">
                <fieldset class="layui-elem-field">
                    <legend>分配信息 <span class="layui-badge layui-bg-orange">待处理</span></legend>
                    <div class="layui-field-box " style="margin-left: 20px;">
                        <div class="layui-row">
                            <div class="layui-col-md9">
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">申请者单位 : <span id="hos_nme"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">申请人 : <span id="doctor_name"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">患者姓名 : <span id="patient_name"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">患者出生日期 : <span id="patient_birth"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">患者身高 : <span id="patient_tall"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">患者体重 : <span id="patient_weight"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">诊断 : <span id="diagnose_result"></span></sapn>
                                </div>
                                <div class="divarea">
                                    <i class="tub layui-icon layui-icon-home" style="color: #FF5722;"></i>
                                    <sapn class="textarea">申请时间 : <span id="create_time"></span></sapn>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="layui-bg-gray">
                    <div>
                        <div style="background: #d2d2d2">
                            <div style="width: 80%;height: 100%;margin: 0 auto;">
<!--                                <div class="layui-collapse" lay-filter="waitingData">-->
<!--                                    <div class="layui-colla-item">-->
<!--                                        <div class="layui-colla-content layui-show" style="background-color:#fdfdfd;">-->
<!--                                            <div style="background-color:#fdfdfd;">-->
<!--                                                <iframe scrolling="no" frameborder="0"-->
<!--                                                        src="../commonData/submitData.html" width="100%"-->
<!--                                                        height="700px" id="waitingData"-->
<!--                                                        onload="this.height=0;var fdh=(this.Document?this.Document.body.scrollHeight:this.contentDocument.body.offsetHeight);this.height=(fdh>700?fdh:700);"></iframe>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
                                <!--流程显示页面-->
                                <div style="background-color:#fdfdfd;margin-top: 10px;padding-top: 20px;">
                                    <iframe scrolling="no" frameborder="0" width="100%"
                                            height="700px" id="processData"
                                            onload="this.height=0;var fdh=(this.Document?this.Document.body.scrollHeight:this.contentDocument.body.offsetHeight);this.height=(fdh>700?fdh:700)"></iframe>

                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="layui-col-md3" style="background-color:#f8f8f8;">
            <fieldset class="layui-elem-field">
                <legend style="font-size: 20px">分发任务</legend>

                <div style="background-color: #f8f8f8;height: auto;margin:10px 20px 0 20px">

                    <form class="layui-form" action="">
                        <div id="checkUser" class="layui-form-item" style="margin-top: 20px">
                            <div style="margin: 10px">医生：</div>
                            <div class="layui-form-item layui-form-text" style="display: inline" id="select">
                                <select name="director" id="director" lay-filter="director" lay-verify="required">
                                    <option value='1'>医生1</option>
                                    <option value='2'>医生2</option>
                                    <option value='3'>医生3</option>
                                </select>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-form-item layui-form-text" style="margin: 10px">
                                分配建议：
                            </div>
                            <div>
                                <textarea name="checkOpinion" required lay-verify="required" placeholder="分配建议..."
                                          class="layui-textarea"></textarea>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <button type="button" class="layui-btn" lay-submit lay-filter="add" id="submit" style="float: right">分配
                            </button>
                        </div>
                    </form>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<br/>
</body>

<script src="../../lib/layui/layui.js"></script>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/application.js"></script>
<script src="/js/hyx.js"></script>

<script>
    $(document).ready(function(){
        //获取诊断编号
        var disgnose_id = GetQueryString("disgnose_id");

        //甚至诊断iframe的src
        $("#processData").attr("src","/pages/commonData/processData.html?disgnose_id="+disgnose_id);

        //设置分配信息
        $.ajax({
            url:'/hos/diagnosis_info/get_diagnosis_by_id',
            type:'get',
            data:{
                'id':disgnose_id
            },
            success:function(data){
                if(data.code == '201'){
                    alert(data.data.msg);//失败的表情
                }else{
                    let datas = data.data;
                    let rs = [];
                    for(let i=0;i<datas.length;i++)
                    {
                        let dia = {};
                        //格式化时间
                        let date = new Date(datas[i].disgnose_info.create_time).Format("yyyy-MM-dd HH:mm:ss");
                        //出生日期
                        let birth = new Date(datas[i].disgnose_info.patient_birth).Format("yyyy-MM-dd");

                        dia.doctor_name = datas[i].doctor_info.doctor_name;
                        dia.patient_name = datas[i].disgnose_info.patient_name;
                        dia.patient_birth = birth;
                        dia.patient_tall = datas[i].disgnose_info.patient_tall;
                        dia.patient_weight = datas[i].disgnose_info.patient_weight;
                        dia.diagnose_result = datas[i].disgnose_info.diagnose_result;
                        dia.hos_nme = datas[i].hos_info.hos_name;
                        dia.create_time = date;
                        dia.comment_text = datas[i].disgnose_info.comment_text;
                        dia.stat = datas[i].disgnose_info.stat;

                        $("#hos_nme").text(dia.hos_nme)
                        $("#patient_name").text(dia.patient_name)
                        $("#patient_birth").text(dia.patient_birth)
                        $("#patient_tall").text(dia.patient_tall)
                        $("#patient_weight").text(dia.patient_weight)
                        $("#diagnose_result").text(dia.diagnose_result)
                        $("#doctor_name").text(dia.doctor_name)
                        $("#create_time").text(dia.create_time)
                    }

                }
            },
        });
    });
</script>

<script>
    let processDataHeight = 0
    //获取处理过程信息
    function getprocessData(processId) {
        $("#processData").on("load", function () {
            var data = {processId: processId}
            this.contentWindow.getParentData(data)
        })
    }



    layui.use(['element','form'], function () {
        var form = layui.form
        form.render('select');
    });


    function caseReturnData(returnData) {

    }

    function processReturnData(returnData) {
        $("#processData").height(returnData.height)
        processDataHeight = returnData.height
    }
</script>

</html>